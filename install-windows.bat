@echo off
chcp 65001
echo.
echo ============================================================
echo    STGC3000 AI Learning Platform - ç»Ÿä¸€çŽ¯å¢ƒå®‰è£…è„šæœ¬
echo ============================================================
echo.
echo  æ­¤è„šæœ¬å°†è‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œ:
echo  1. æ£€æŸ¥ Node.js çŽ¯å¢ƒã€‚
echo  2. å®‰è£…åŽç«¯å’Œå‰ç«¯çš„æ‰€æœ‰å¿…éœ€ä¾èµ–åŒ…ã€‚
echo  3. è‡ªåŠ¨åˆ›å»ºåŽç«¯ .env é…ç½®æ–‡ä»¶ (å¦‚æžœä¸å­˜åœ¨)ã€‚
echo.
echo  æŒ‰ä»»æ„é”®å¼€å§‹å®‰è£…...
pause >nul
echo.

REM --- æ£€æŸ¥ Node.js çŽ¯å¢ƒ ---
echo [*] æ­£åœ¨æ£€æŸ¥ Node.js çŽ¯å¢ƒ...
node --version >nul 2>&1
if %errorlevel% neq 0 (
    echo [ERROR] æœªæ£€æµ‹åˆ° Node.js çŽ¯å¢ƒã€‚
    echo [!] è¯·å…ˆè®¿é—® https://nodejs.org/ ä¸‹è½½å¹¶å®‰è£… Node.js (æŽ¨èLTSç‰ˆæœ¬)ã€‚
    pause
    exit /b 1
)
echo [âœ“] Node.js çŽ¯å¢ƒæ­£å¸¸ã€‚
node --version
echo.

REM --- å®‰è£…åŽç«¯ä¾èµ– ---
echo ========================================
echo    æ­¥éª¤ 1: å®‰è£…åŽç«¯ä¾èµ–
echo ========================================
cd /d "%~dp0server"
echo [*] å½“å‰ç›®å½•: %cd%
echo [*] æ­£åœ¨å®‰è£…åŽç«¯ä¾èµ–åŒ… (npm install)...
call npm install
if %errorlevel% neq 0 (
    echo [ERROR] åŽç«¯ä¾èµ–å®‰è£…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¸Šæ–¹çš„é”™è¯¯ä¿¡æ¯ã€‚
    pause
    exit /b 1
)
echo [âœ“] åŽç«¯ä¾èµ–å®‰è£…å®Œæˆ!
echo.

REM --- åˆ›å»ºåŽç«¯ .env æ–‡ä»¶ ---
echo ========================================
echo    æ­¥éª¤ 2: æ£€æŸ¥å¹¶åˆ›å»º .env é…ç½®æ–‡ä»¶
echo ========================================
if not exist ".env" (
    echo [!] é…ç½®æ–‡ä»¶ (.env) ä¸å­˜åœ¨ã€‚
    if exist ".env.example" (
        echo [*] æ­£åœ¨ä»Ž .env.example æ¨¡æ¿åˆ›å»º...
        copy .env.example .env >nul
        echo [âœ“] .env æ–‡ä»¶å·²æˆåŠŸåˆ›å»ºäºŽ `server` ç›®å½•ã€‚
        echo.
        echo [IMPORTANT] å®‰è£…å®ŒæˆåŽï¼Œè¯·åŠ¡å¿…æ‰“å¼€ `server/.env` æ–‡ä»¶ï¼Œ
        echo             å¹¶å¡«å…¥æ‚¨è‡ªå·±çš„ `DEEPSEEK_API_KEY`ã€‚
    ) else (
        echo [WARNING] æœªæ‰¾åˆ° .env.example æ¨¡æ¿æ–‡ä»¶ï¼Œæ— æ³•è‡ªåŠ¨åˆ›å»º .envã€‚
        echo             è¯·åœ¨å®‰è£…åŽæ‰‹åŠ¨åˆ›å»º `server/.env` æ–‡ä»¶ã€‚
    )
) else (
    echo [âœ“] é…ç½®æ–‡ä»¶ .env å·²å­˜åœ¨ï¼Œæ— éœ€åˆ›å»ºã€‚
)
echo.

REM --- å®‰è£…å‰ç«¯ä¾èµ– ---
echo ========================================
echo    æ­¥éª¤ 3: å®‰è£…å‰ç«¯ä¾èµ–
echo ========================================
cd /d "%~dp0client"
echo [*] å½“å‰ç›®å½•: %cd%
echo [*] æ­£åœ¨å®‰è£…å‰ç«¯ä¾èµ–åŒ… (npm install)...
call npm install
if %errorlevel% neq 0 (
    echo [ERROR] å‰ç«¯ä¾èµ–å®‰è£…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¸Šæ–¹çš„é”™è¯¯ä¿¡æ¯ã€‚
    pause
    exit /b 1
)
echo [âœ“] å‰ç«¯ä¾èµ–å®‰è£…å®Œæˆ!
echo.

echo ============================================================
echo    ðŸŽ‰ çŽ¯å¢ƒå®‰è£…æˆåŠŸ!
echo ============================================================
echo.
echo  åŽç»­æ“ä½œ:
echo.
echo  1. (é‡è¦) å¦‚æžœæ˜¯é¦–æ¬¡å®‰è£…ï¼Œè¯·æ‰“å¼€ `server/.env` æ–‡ä»¶å¹¶å¡«å…¥æ‚¨çš„APIå¯†é’¥ã€‚
echo.
echo  2. å¯åŠ¨å¼€å‘çŽ¯å¢ƒ:
echo     - ç›´æŽ¥è¿è¡Œæ ¹ç›®å½•ä¸‹çš„ `start-windows.bat` å³å¯ä¸€é”®å¯åŠ¨å‰åŽç«¯ã€‚
echo.
echo  3. å¦‚æžœéœ€è¦å•ç‹¬å¯åŠ¨:
echo     - åŽç«¯: è¿›å…¥ `server` ç›®å½•, è¿è¡Œ `start-dev.bat`
echo     - å‰ç«¯: è¿›å…¥ `client` ç›®å½•, è¿è¡Œ `start-dev.bat`
echo.
echo  æ„Ÿè°¢ä½¿ç”¨! æŒ‰ä»»æ„é”®é€€å‡º...
pause >nul